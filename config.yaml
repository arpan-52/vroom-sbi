# VROOM-SBI Configuration File (v2.0)

# Frequency file path
freq_file: "freq.txt"

# Faraday depth range (rad/mÂ²)
phi:
  min: -1000.0
  max: 1000.0
  n_samples: 200

# Prior ranges for parameters
priors:
  rm:
    min: -500.0
    max: 500.0
  amp:
    min: 0.01
    max: 1.0

# Noise configuration
noise:
  base_level: 0.01
  augmentation:
    enable: true
    min_factor: 0.5
    max_factor: 2.0

# Memory management (NEW in v2.0)
memory:
  max_ram_gb: 16.0          # Maximum RAM to use for staging models
  max_vram_gb: 8.0          # Maximum GPU memory to use
  stage_models_to_ram: true # Keep models in RAM when not on GPU
  prefetch_models: true     # Load all models at startup
  gradient_checkpointing: false  # Trade compute for memory
  mixed_precision: true     # Use FP16 where possible

# Training settings
training:
  n_simulations: 30000
  simulation_scaling: true
  simulation_scaling_mode: "power"
  scaling_power: 2.5
  batch_size: 50
  n_rounds: 1
  device: "cuda"
  validation_fraction: 0.1
  save_dir: "models"
  
  # Checkpointing (NEW in v2.0)
  checkpoint_interval: 5    # Save every N epochs
  log_interval: 1           # Log metrics every N epochs
  early_stopping_patience: 10

# Model selection
model_selection:
  max_components: 5
  use_classifier: true
  classifier_only: false

# Physical model types
physics:
  model_types:
    - "faraday_thin"
    - "burn_slab"
    - "external_dispersion"
    - "internal_dispersion"

  # Model-specific parameters
  burn_slab:
    max_delta_phi: 200.0

  external_dispersion:
    max_sigma_phi: 200.0

  internal_dispersion:
    max_sigma_phi: 200.0

# Weight augmentation
weight_augmentation:
  enable: true
  scattered_prob: 0.3
  gap_prob: 0.3
  large_block_prob: 0.1
  noise_variation: true

# Model Selection Classifier (1D CNN)
classifier:
  conv_channels: [32, 64, 128]
  kernel_sizes: [7, 5, 3]
  dropout: 0.1
  n_epochs: 50
  batch_size: 1024
  learning_rate: 0.0001
  validation_fraction: 0.2
  use_posterior_simulations: true

# SBI Architecture (Neural Posterior Estimation)
sbi:
  model: 'nsf'
  num_bins: 16
  embedding_dim: 64
  
  # Architecture per component count
  architecture_scaling:
    1:
      hidden_features: 256
      num_transforms: 15
    2:
      hidden_features: 256
      num_transforms: 15
    3:
      hidden_features: 256
      num_transforms: 15
    4:
      hidden_features: 256
      num_transforms: 15
    5:
      hidden_features: 256
      num_transforms: 15
